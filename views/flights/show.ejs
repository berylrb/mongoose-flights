<%- include("../partials/html-head") %>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="/stylesheets/flights/show.css" />
<%- include("../partials/nav") %>  

<main>
  <h1><%= title %></h1>
    <table id="flight-table">
      <thead id="flight-thead">
        <tr>
          <th>EDIT FLIGHT</th>
          <th>AIRLINE</th>
          <th>AIRPORT</th>
          <th>FLIGHT NUMBER</th>
          <th>DEPARTS</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="/flights/<%= flight._id %>/edit" <%- title === 'Edit Flight' ? 'class="active"' : '' %>>Edit Flight Details</a></td>
          <td><%= flight.airline %></td>
          <td><%= flight.airport %></td>
          <td><%= flight.flightNo %></td>
          <td class=<%= flight.departs < Date.now()?"passed":"upcoming"%>><%= flight.departs.toLocaleDateString() + " - " + flight.departs.toLocaleTimeString([], {timeStyle: 'short'}) %></td>
        </tr>
      </tbody>
    </table>
    <br>
    <hr>
  <h2>Add New Ticket</h2>
  <div class="wrapper">
    <form id="add-ticket-form" action="/flights/<%= flight._id %>/tickets" method="POST">
      <label for="seat">Seat Selection</label><br>
      <input type="text" name="seat" id="seat-input" required pattern="[A-F][1-9]\d?" placeholder="Enter Seat Number"><br>
      <label for="price">Ticket Price</label><br>
      <input type="number" name="price" id="price-input" placeholder="Enter Ticket Price"><br>
      <button type="submit">Add Ticket</button>
    </form>
  </div>
  <hr>
  <br>
  <br>
  <section>
    <% if (flight.tickets.length) { %> 
      <table id="tickets-table">
        <thead id="tickets-thead">
          <caption>Tickets</caption>
          <tr id="tickets-tr">
            <th id="tickets-th-delete">DELETE</th>
            <th id="tickets-th" onclick="sortTable(0)">SEAT</th>
            <th id="tickets-th" onclick="sortTable(1)">PRICE</th>
          </tr>
        </thead>
        <tbody id="tickets">
          <% flight.tickets.forEach(ticket => { %>
            <tr id="tickets-tr">
              <td id="tickets-td-delete"><form action="/flights/<%= flight._id %>/tickets/<%= ticket._id %>?_method=DELETE" class="delete-form" method="POST">
                <button id="delete" type="submit" onclick="return confirm('Are you sure you want to delete this ticket?')"><span class="bi bi-trash"></span></button>
              </form></td>
              <td id="tickets-td"><%= ticket.seat %> </td>
              <td id="tickets-td">$<%= ticket.price %> </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <h3>Hmm... Looks like this flight doesn't have tickets yet.</h3>  
    <% } %>
  </section>

<section>
  <div>Flight Menu:</div>
  <ul>
    <% flight.meals.forEach(meal => { %>
      <li><%= meal.name %></li>
    <% }) %>
  </ul>
</section>

<form id="add-meal-flight" action="" method="">
  <select name="mealId">
    <% meals.forEach(meal => { %>
      <option value="<%= meal._id %>"><%= meal.name %></option>
    <% }) %>
  </select>
</form>
</main>

<%- include("../partials/footer") %>  